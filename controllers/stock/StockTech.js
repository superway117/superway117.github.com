(function(){var e,f,d,b={}.hasOwnProperty,c=function(j,h){for(var g in h){if(b.call(h,g)){j[g]=h[g]}}function i(){this.constructor=j}i.prototype=h.prototype;j.prototype=new i();j.__super__=h.prototype;return j},a=function(g,h){return function(){return g.apply(h,arguments)}};e=Spine.$;d=(function(h){c(g,h);function g(){return g.__super__.constructor.apply(this,arguments)}g.configure("TechSetting","range","type","scale","size","ema","indicator","overlay");g.extend(Spine.Model.Local);g["default"]={range:"1m",type:"line",scale:"log",size:"middle",moving:"",ema:"",indicator:"",overlay:""};return g})(Spine.Model);f=(function(g){c(h,g);h.prototype.tmplId="stockTechTmpl";h.prototype.headerMenuItem={name:"tech",text:"技术指标"};h.prototype.events={"click button[type=button]":"deTapButton","change form.form-inline select":"deSelectIndicator","submit form.form-inline":"deCompare","focus form.form-inline input[type=text]":"deClearCompare"};h.prototype.elements={"form.form-inline input[type=text]":"compareText"};function h(){this.meSettingRefresh=a(this.meSettingRefresh,this);this.render=a(this.render,this);this.compareTypeAhead=a(this.compareTypeAhead,this);h.__super__.constructor.apply(this,arguments);d.bind("refresh",this.meSettingRefresh);d.bind("change",this.render);d.fetch();this.compareText.typeahead({source:this.compareTypeAhead,matcher:function(){return true}})}h.prototype.compareTypeAhead=function(o,l){var k,n,m,j,i;n=Stock.StockDict.query(o);i=[];for(m=0,j=n.length;m<j;m++){k=n[m];i.push(k.join(","))}return i};h.prototype.deClearCompare=function(i){return e(i.target).val("")};h.prototype.render=function(j){var l,k,i;k=d.first().attributes()||d["default"];if(j){if(Stock.Util.isString(j)){k.compare=j}else{l=j[0];k.compare=l}}i=Stock.YahooStock.fetchTechChart(this.page.stockID,k);return this.$("#techChart").attr("src",i)};h.prototype.meSettingRefresh=function(){var i;i=d.first();if(!i){return d.create(d["default"])}};h.prototype.activate=function(){h.__super__.activate.apply(this,arguments);this.$("#otherTech").collapse();return this.refreshButtonState()};h.prototype.refreshButtonState=function(){var l,j,k,i;j=d.first().attributes()||d["default"];i=[];for(l in j){k=j[l];if(k!==""){i.push(this.$("button[data-command="+l+"][data-value="+k+"]").button("toggle"))}else{i.push(void 0)}}return i};h.prototype.deTapButton=function(l){var m,j,i,k;i=d.first();j=e(l.target);m=j.attr("data-command");k=j.attr("data-value");if(i[m]===k){i[m]=""}else{i[m]=k}return i.save()};h.prototype.deSelectIndicator=function(k){var i,j;i=d.first();j=e(k.target).val();if(j!==""){i.indicator=j;return i.save()}};h.prototype.deCompare=function(j){var i;i=this.compareText.val().slice(0,6);if(!Stock.Util.isValidStockID(i)){return false}return this.trigger("refresh",i)};return h})(Stock.StaticPanel);window.Stock.StockTech=f}).call(this);
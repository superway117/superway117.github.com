(function(){var e,c,b=function(g,h){return function(){return g.apply(h,arguments)}},a={}.hasOwnProperty,d=function(j,h){for(var g in h){if(a.call(h,g)){j[g]=h[g]}}function i(){this.constructor=j}i.prototype=h.prototype;j.prototype=new i();j.__super__=h.prototype;return j},f=[].slice;e=Spine.$;c=(function(h){d(g,h);g.prototype.tmplId="stockInfoTmpl";g.prototype.dataTmplId="stockInfoDataTmpl";g.prototype.headerMenuItem={name:"info",text:"基本信息"};g.prototype.events={"click .form-inline button.stock-add-btn":"deOpenAddStockModal","click #addTagButton":"deAddTag","click #addStockButton":"deAddStock"};g.prototype.elements={"div[data-role=panel-data]":"panelData",".modal-body select":"tagSelects",".modal-body input[type=text]":"newTagText",".modal-body form":"addStockForm",".form-inline button.stock-add-btn":"openAddModalButton"};function g(){this.fetchData=b(this.fetchData,this);this.fetchFinished=b(this.fetchFinished,this);g.__super__.constructor.apply(this,arguments);this["gstock"]=new Stock.GoogStock;this.gstock.bind("fetchFinished",this.fetchFinished)}g.prototype.fetchFinished=function(i){var j;if(i.status==="succ"){j=i.list[0];j.chart=Stock.YahooStock.fetchLargeChart(this.page.stockID);return this.trigger("dataReady",j)}};g.prototype.render=function(j){var i;this.panelData.html(e("#"+this.dataTmplId).tmpl(j));if(j){if(j.c.charAt(0)==="-"){i="#468847"}else{if(j.c.charAt(0)==="+"){i="#FF0000"}}if(i){this.$("#updownCell").css("color",i)}}if(this.page.stockID===this.page.homeID){return this.$(".form-inline button.stock-add-btn").attr("disabled","disabled")}else{return this.$(".form-inline button.stock-add-btn").removeAttr("disabled")}};g.prototype.fetchData=function(){var i;i=1<=arguments.length?f.call(arguments,0):[];return this.gstock.fetchStock(this.page.stockID)};g.prototype.activate=function(){g.__super__.activate.apply(this,arguments);return this.startRefreshTimer()};g.prototype.startRefreshTimer=function(){if(this.isActive()){this.delay(this.startRefreshTimer,60000);return this.refresh()}};g.prototype.updateTagSelects=function(){var n,k,l,m,j,i;Stock.TagList.fetch();if(Stock.TagList.count()===0){Stock.TagList.create(Stock.TagList["default"])}l=Stock.TagList.all();this.tagSelects.empty();i=[];for(m=0,j=l.length;m<j;m++){k=l[m];n={name:k.name,text:k.name};i.push(this.tagSelects.append(e("#selectItemTmpl").tmpl(n)))}return i};g.prototype.appendTagSelect=function(i){var j;if(Stock.TagList.findByAttribute("name",i)){return Stock.Util.openAlert(this.addStockForm,{type:"alert-error",body:"Tag已经存在"})}else{j={name:i,text:i};Stock.TagList.create({name:i});this.tagSelects.prepend(e("#selectItemTmpl").tmpl(j));return this.tagSelects.get(0).selectedIndex=0}};g.prototype.deOpenAddStockModal=function(i){this.updateTagSelects();e("#addStockModal").modal();i.preventDefault();return false};g.prototype.deAddTag=function(j){var i;i=this.newTagText.val();if(!i){Stock.Util.openAlert(this.addStockForm,{type:"alert-error",body:"名字不能为空"})}else{this.appendTagSelect(i)}j.preventDefault();return false};g.prototype.deAddStock=function(k){var j,i,l=this;i=this.tagSelects.val();j=Stock.StockList.select(function(m){return m.stock===l.page.stockID&&m.tag===i});if(j.length>0){Stock.Util.openAlert(this.addStockForm,{type:"alert-error",body:"股票已经存在"})}else{Stock.StockList.create({stock:this.page.stockID,tag:i});e("#addStockModal").modal("hide")}k.preventDefault();return false};return g})(Stock.MixedPanel);window.Stock.StockInfo=c}).call(this);
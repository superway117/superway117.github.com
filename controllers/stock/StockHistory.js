(function(){var e,a,c=function(f,g){return function(){return f.apply(g,arguments)}},b={}.hasOwnProperty,d=function(i,g){for(var f in g){if(b.call(g,f)){i[f]=g[f]}}function h(){this.constructor=i}h.prototype=g.prototype;i.prototype=new h();i.__super__=g.prototype;return i};e=Spine.$;a=(function(g){d(f,g);f.prototype.tmplId="stockHistoryTmpl";f.prototype.tableTmplId="stockHistoryTableTmpl";f.prototype.events={"submit form":"deFetchHistory"};f.prototype.elements={"table tbody":"table","#startDate":"startDate","#endDate":"endDate"};f.prototype.headerMenuItem={name:"history",text:"历史信息"};function f(){this.fetchData=c(this.fetchData,this);this.fetchFinished=c(this.fetchFinished,this);f.__super__.constructor.apply(this,arguments);this["ystock"]=new Stock.YahooStock;this.ystock.bind("fetchHistoryFinished",this.fetchFinished)}f.prototype.fetchFinished=function(h){var i;if(h.status==="succ"){i=h.list;return this.trigger("dataReady",i)}};f.prototype.render=function(h){return this.table.html(e("#"+this.tableTmplId).tmpl(h))};f.prototype.fetchData=function(h){var i,j;j=Stock.Util.getDaysBeforeDate(7);i={stockID:this.page.stockID,startY:j.getFullYear(),startM:j.getMonth(),startD:j.getDate()};e.extend(i,h);return this.ystock.fetchHistory(i)};f.prototype.deFetchHistory=function(j){var h,i,k;j.preventDefault();k=this.startDate.val().split("-");h=this.endDate.val().split("-");if(new Date(k[2],k[0],k[1])>new Date(h[2],h[0],h[1])){Stock.Util.openPromptInfo(this.page,{header:"Warning",body:"结束日期必须大于起始日期"});return false}i={startY:k[2],startM:(+k[0])-1,startD:k[1],endY:h[2],endM:(+h[0])-1,endD:h[1]};return this.trigger("refresh",i)};f.prototype.activate=function(){var i,h;f.__super__.activate.apply(this,arguments);h=Stock.Util.getNowDateString();this.endDate.datepicker("setValue",h);this.endDate.val(h);this.endDate.attr("data-date",h);i=Stock.Util.getDaysBeforeString(7);this.startDate.datepicker("setValue",i);this.startDate.val(i);this.startDate.attr("data-date",i);this.startDate.datepicker();return this.endDate.datepicker()};f.prototype.canonicalDate=function(h){if(h.length===2&&h.charAt(0)==="0"){return h.slice(1)}return h};return f})(Stock.MixedPanel);window.Stock.StockHistory=a}).call(this);
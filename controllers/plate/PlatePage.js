(function(){var f,d,c,b=function(g,h){return function(){return g.apply(h,arguments)}},a={}.hasOwnProperty,e=function(j,h){for(var g in h){if(a.call(h,g)){j[g]=h[g]}}function i(){this.constructor=j}i.prototype=h.prototype;j.prototype=new i();j.__super__=h.prototype;return j};f=Spine.$;c=(function(h){e(g,h);g.prototype.tmplId="plateTmpl";g.prototype.generalTableTmplId="plateGeneralTableTmpl";g.prototype.baseTableTmplId="plateBaseTableTmpl";g.prototype.stockLabel=null;g.prototype.timerStart=false;g.prototype.events={"shown a[data-toggle='tab']":"deSwitchTab","click div.tab-content tbody td:nth-child(2)":"deGotoInfoPage","change #generalTab thead input[type=checkbox]":"deCheckAllGeneral","change #baseTab thead input[type=checkbox]":"deCheckAllBase","click #deleteBtn":"deDelete","click #compareBtn":"deCompare"};g.prototype.elements={"ui.nav-tabs":"tabs","#tagLabel":"tagLabel","#generalTab tbody":"generalTable","#baseTab tbody":"baseTable","#generalTab thead tr input[type=checkbox]":"generalAllCheckboxs","#generalTab tbody tr input[type=checkbox]":"generalCheckboxs","#baseTab tbody thead input[type=checkbox]":"baseAllCheckboxs","#baseTab tbody tr input[type=checkbox]":"baseCheckboxs","#deleteBtn":"deleteBtn","#compareBtn":"compareBtn"};g.prototype.tabList={generalTab:"generalFetch",baseTab:"baseFetch"};g.prototype.getActiveTab=function(i){return this.$("li.active",this.tabs).attr("data-value")};g.prototype.setLabel=function(i){this.stockLabel=i;return this.tagLabel.text(i)};function g(){this.deGotoInfoPage=b(this.deGotoInfoPage,this);this.fetchData=b(this.fetchData,this);this.fetchQuotesFinished=b(this.fetchQuotesFinished,this);this.fetchLastFinished=b(this.fetchLastFinished,this);g.__super__.constructor.apply(this,arguments);this["ystock"]=new Stock.YahooStock;this.ystock.bind("fetchLastFinished",this.fetchLastFinished);this.ystock.bind("fetchQuotesFinished",this.fetchQuotesFinished)}g.prototype.startRefreshTimer=function(){if(this.isActive()&&this.getActiveTab()==="generalTab"){this.delay(this.startRefreshTimer,60000);return this.refresh()}};g.prototype.activate=function(){g.__super__.activate.apply(this,arguments);return this.startRefreshTimer()};g.prototype.resetCheckbox=function(){this.generalAllCheckboxs.attr("checked",false);return this.baseAllCheckboxs.attr("checked",false)};g.prototype.primitiveRefresh=function(i){if(i!=null?i.resetLabel:void 0){this.setLabel(Stock.TagList.first().name)}if(i!=null?i.resetHeader:void 0){this.page.updateHeaderMenu()}this.resetCheckbox();return this.refresh()};g.prototype.deSwitchTab=function(i){return this.refresh()};g.prototype.fetchLastFinished=function(i){var j;if(i.status==="succ"){j=i.list;return this.generalRender(j)}};g.prototype.fetchQuotesFinished=function(i){var j;if(i.status==="succ"){j=i.list;return this.baseRender(j)}};g.prototype.generalFetch=function(i){return this.ystock.fetchLast(i)};g.prototype.baseFetch=function(i){return this.ystock.fetchQuotes(i)};g.prototype.generalRender=function(j){var i;this.generalTable.html(f("#"+this.generalTableTmplId).tmpl(j));if(j){if(j.price<j.preclose){i="#468847"}else{i="#FF0000"}}if(i){this.$("#generalTab .price").css("color",i)}return this.refreshElements()};g.prototype.baseRender=function(i){this.baseTable.html(f("#"+this.baseTableTmplId).tmpl(i));return this.refreshElements()};g.prototype.fetchData=function(){var i,l,k,m,j,n=this;m=Stock.StockList.select(function(o){return o.tag===n.stockLabel});if(m.length===0){this.generalTable.html("");this.baseTable.html("");this.deleteBtn.text("删除Label");if(this.stockLabel===Stock.TagList["default"].name){this.deleteBtn.attr("disabled","disabled")}else{this.deleteBtn.removeAttr("disabled")}this.compareBtn.attr("disabled","disabled");return this.refreshElements()}else{this.deleteBtn.removeAttr("disabled");this.compareBtn.removeAttr("disabled");this.deleteBtn.text("删除");l=(function(){var q,p,o;o=[];for(q=0,p=m.length;q<p;q++){j=m[q];o.push(j.stock)}return o})();i=this.getActiveTab();k=this.tabList[i];if(this[k]){return this[k](l)}}};g.prototype.deGotoInfoPage=function(j){var i,k;i=f(j.target);if(i.is("a")){i=i.parent()}k=i.attr("data-value");this.page.triggerPageEvent("getinfo",k);return false};g.prototype.deCheckAllGeneral=function(j){var i;i=f(j.target);this.generalCheckboxs.attr("checked",i.is(":checked"));return false};g.prototype.deCheckAllBase=function(j){var i;i=f(j.target);this.baseCheckboxs.attr("checked",i.is(":checked"));return false};g.prototype.deDelete=function(l){var k,j,i,m=this;if(this.getActiveTab()==="generalTab"){k=this.generalCheckboxs}else{k=this.baseCheckboxs}j=[];k.each(function(o,r){var p,n,q;p=f(r);if(p.is(":checked")){q=p.parent().next().attr("data-value");n=Stock.StockList.select(function(s){return s.stock===q&&s.tag===m.stockLabel});return j.push(n[0])}});if(j.length>0){Stock.Util.openComfirmModal(this.page,{header:"Warning",body:"确定删除?"},function(){var o,p,n;for(p=0,n=j.length;p<n;p++){o=j[p];o.destroy()}return m.primitiveRefresh()})}else{j=Stock.StockList.select(function(n){return n.tag===m.stockLabel});if(j.length===0&&this.stockLabel!==Stock.TagList["default"].name){i=Stock.TagList.findByAttribute("name",this.stockLabel);if(i){i.destroy()}this.primitiveRefresh({resetLabel:true,resetHeader:true})}}return false};g.prototype.deCompare=function(k){var j,i,l=this;if(this.getActiveTab()==="generalTab"){j=this.generalCheckboxs}else{j=this.baseCheckboxs}i=[];j.each(function(m,p){var n,o;n=f(p);if(n.is(":checked")){o=n.parent().next().attr("data-value");return i.push(o)}});if(i.length>1){this.page.triggerPageEvent("compare",i);this.resetCheckbox()}return false};return g})(Stock.MixedPanel);d=(function(h){e(g,h);g.prototype["default"]="plate";g.prototype.footerMenuItem={name:"plate",text:"板块"};g.prototype.controllers={plate:c};function g(){g.__super__.constructor.apply(this,arguments);Stock.TagList.fetch();Stock.StockList.fetch();if(Stock.TagList.count()===0){Stock.TagList.create(Stock.TagList["default"])}this.plate.setLabel(Stock.TagList.first().name)}g.prototype.activate=function(){g.__super__.activate.apply(this,arguments);return this.updateHeaderMenu()};g.prototype.updateHeaderMenu=function(){var m,i,l,j,k,n=this;this.clearHeaderMenu();k=Stock.TagList.all();for(l=0,j=k.length;l<j;l++){i=k[l];i=i.attributes();m={name:i.name,text:i.name};this.appendHeaderMenu(m)}return f("a",this.headerDropMenu).click(function(p){var o;o=f(p.target);return n.setLabel(o.attr("name"))})};g.prototype.setLabel=function(i){this.plate.setLabel(i);return this.plate.refresh()};g.prototype.deQuickBarClick=function(j){var i,k;i=f(j.target);k=i.attr("name");if(!Stock.Util.isValidStockID(k)){return false}if(k){this.triggerPageEvent("getinfo",k)}return false};g.prototype.deFetchStock=function(i){var j;j=this.searchText.val().slice(0,6);if(!Stock.Util.isValidStockID(j)){return false}this.triggerPageEvent("getinfo",j);return false};g.prototype.deGoHome=function(i){this.triggerPageEvent("getinfo","000001.SS");return false};return g})(Stock.StockBasePage);window.Stock.PlatePage=d}).call(this);
(function(){var d,b,a={}.hasOwnProperty,c=function(i,g){for(var f in g){if(a.call(g,f)){i[f]=g[f]}}function h(){this.constructor=i}h.prototype=g.prototype;i.prototype=new h();i.__super__=g.prototype;return i},e=[].slice;b=this.Spine||require("spine");d=b.$;b.Manager=(function(g){c(f,g);f.include(b.Events);function f(){this.controllers=[];this.bind("change",this.change);this.add.apply(this,arguments)}f.prototype.add=function(){var h,l,k,j,i;l=1<=arguments.length?e.call(arguments,0):[];i=[];for(k=0,j=l.length;k<j;k++){h=l[k];i.push(this.addOne(h))}return i};f.prototype.addOne=function(h){var i=this;h.bind("active",function(){var j;j=1<=arguments.length?e.call(arguments,0):[];return i.trigger.apply(i,["change",h].concat(e.call(j)))});h.bind("release",function(){return i.controllers.splice(i.controllers.indexOf(h),1)});return this.controllers.push(h)};f.prototype.deactivate=function(){return this.trigger.apply(this,["change",false].concat(e.call(arguments)))};f.prototype.change=function(){var k,h,n,m,j,l,i;n=arguments[0],k=2<=arguments.length?e.call(arguments,1):[];l=this.controllers;i=[];for(m=0,j=l.length;m<j;m++){h=l[m];if(h===n){i.push(h.activate.apply(h,k))}else{i.push(h.deactivate.apply(h,k))}}return i};return f})(b.Module);b.Controller.include({active:function(){var f;f=1<=arguments.length?e.call(arguments,0):[];if(typeof f[0]==="function"){this.bind("active",f[0])}else{f.unshift("active");this.trigger.apply(this,f)}return this},isActive:function(){return this.el.hasClass("active")},activate:function(){this.el.addClass("active");return this},deactivate:function(){this.el.removeClass("active");return this}});b.Stack=(function(g){c(f,g);f.prototype.controllers={};f.prototype.routes={};f.prototype.className="spine stack";function f(){var i,k,m,j,h,l=this;f.__super__.constructor.apply(this,arguments);this.manager=new b.Manager;j=this.controllers;for(i in j){k=j[i];this[i]=new k({stack:this});this.add(this[i])}h=this.routes;m=function(n,o){var p;if(typeof o==="function"){p=o}p||(p=function(){var q;return(q=l[o]).active.apply(q,arguments)});return l.route(n,p)};for(i in h){k=h[i];m(i,k)}if(this["default"]){this[this["default"]].active()}}f.prototype.add=function(h){this.manager.add(h);return this.append(h)};return f})(b.Controller);if(typeof module!=="undefined"&&module!==null){module.exports=b.Manager}if(typeof module!=="undefined"&&module!==null){module.exports.Stack=b.Stack}}).call(this);
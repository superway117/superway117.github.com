(function(){var c,g,b,h,i,e,f={}.hasOwnProperty,a=function(m,k){for(var j in k){if(f.call(k,j)){m[j]=k[j]}}function l(){this.constructor=m}l.prototype=k.prototype;m.prototype=new l();m.__super__=k.prototype;return m},d=[].slice;g=this.Spine||require("spine");c=g.$;h=/^#*/;i=/:([\w\d]+)/g;e=/\*([\w\d]+)/g;b=/[-[\]{}()+?.,\\^$|#\s]/g;g.Route=(function(j){var k;a(l,j);l.extend(g.Events);l.historySupport=((k=window.history)!=null?k.pushState:void 0)!=null;l.routes=[];l.options={trigger:true,history:false,shim:false};l.add=function(p,q){var n,o,m;if(typeof p==="object"&&!(p instanceof RegExp)){m=[];for(n in p){o=p[n];m.push(this.add(n,o))}return m}else{return this.routes.push(new this(p,q))}};l.setup=function(m){if(m==null){m={}}this.options=c.extend({},this.options,m);if(this.options.history){this.history=this.historySupport&&this.options.history}if(this.options.shim){return}if(this.history){c(window).bind("popstate",this.change)}else{c(window).bind("hashchange",this.change)}return this.change()};l.unbind=function(){if(this.history){return c(window).unbind("popstate",this.change)}else{return c(window).unbind("hashchange",this.change)}};l.navigate=function(){var n,p,m,o;n=1<=arguments.length?d.call(arguments,0):[];m={};p=n[n.length-1];if(typeof p==="object"){m=n.pop()}else{if(typeof p==="boolean"){m.trigger=n.pop()}}m=c.extend({},this.options,m);o=n.join("/");if(this.path===o){return}this.path=o;this.trigger("navigate",this.path);if(m.trigger){this.matchRoute(this.path,m)}if(m.shim){return}if(this.history){return history.pushState({},document.title,this.path)}else{return window.location.hash=this.path}};l.getPath=function(){var m;m=window.location.pathname;if(m.substr(0,1)!=="/"){m="/"+m}return m};l.getHash=function(){return window.location.hash};l.getFragment=function(){return this.getHash().replace(h,"")};l.getHost=function(){return(document.location+"").replace(this.getPath()+this.getHash(),"")};l.change=function(){var m;m=this.getFragment()!==""?this.getFragment():this.getPath();if(m===this.path){return}this.path=m;return this.matchRoute(this.path)};l.matchRoute=function(r,p){var o,q,n,m;m=this.routes;for(q=0,n=m.length;q<n;q++){o=m[q];if(o.match(r,p)){this.trigger("change",o,r);return o}}};function l(n,o){var m;this.path=n;this.callback=o;this.names=[];if(typeof n==="string"){i.lastIndex=0;while((m=i.exec(n))!==null){this.names.push(m[1])}e.lastIndex=0;while((m=e.exec(n))!==null){this.names.push(m[1])}n=n.replace(b,"\\$&").replace(i,"([^/]*)").replace(e,"(.*?)");this.route=new RegExp("^"+n+"$")}else{this.route=n}}l.prototype.match=function(r,o){var p,n,t,s,q,m;if(o==null){o={}}n=this.route.exec(r);if(!n){return false}o.match=n;s=n.slice(1);if(this.names.length){for(p=q=0,m=s.length;q<m;p=++q){t=s[p];o[this.names[p]]=t}}return this.callback.call(null,o)!==false};return l})(g.Module);g.Route.change=g.Route.proxy(g.Route.change);g.Controller.include({route:function(j,k){return g.Route.add(j,this.proxy(k))},routes:function(k){var l,m,j;j=[];for(l in k){m=k[l];j.push(this.route(l,m))}return j},navigate:function(){return g.Route.navigate.apply(g.Route,arguments)}});if(typeof module!=="undefined"&&module!==null){module.exports=g.Route}}).call(this);
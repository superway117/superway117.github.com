(function(){var d,b,i,j,f,h,a,g={}.hasOwnProperty,c=function(n,l){for(var k in l){if(g.call(l,k)){n[k]=l[k]}}function m(){this.constructor=n}m.prototype=l.prototype;n.prototype=new m();n.__super__=l.prototype;return n},e=[].slice;d=Spine.$;j=(function(l){c(k,l);k.prototype.controllers={};k.prototype.tmplId=null;k.prototype.footerMenuItem=null;k.prototype.footerMenuLoaded=false;function k(n){var o,q,s,p,m,r=this;k.__super__.constructor.apply(this,arguments);this.loadFromTemplate();this.manager=new Spine.Manager;p=this.controllers;for(o in p){q=p[o];this[o]=new q({page:this});this.addPanel(this[o])}m=this.routes;s=function(t,u){var v;if(typeof u==="function"){v=u}v||(v=function(){var w;return(w=r[u]).active.apply(w,arguments)});return r.route(t,v)};for(o in m){q=m[o];s(o,q)}if(this["default"]){this[this["default"]].el.addClass("active")}}k.prototype.loadFromTemplate=function(){this.replace(d("#"+this.tmplId).html());this.content=this.$("div[data-role=content]");this.headerDropMenu=this.$("div[data-role=header] .pull-right .dropdown-menu");this.footerMenu=this.$("div[data-role=footer] .navbar .nav");return this.quickBar=this.$("div[data-role='header'] ul[data-role='quickbar']")};k.prototype.loadFooterMenu=function(){var n,p,m,o,q=this;if(this.footerMenuLoaded){return}this.footerMenu.empty();o=this.stack.getFooterMenu();for(p=0,m=o.length;p<m;p++){n=o[p];this.footerMenu.append(d("#menuItemTmpl").tmpl(n))}d("a",this.footerMenu).click(function(s){var r;r=d(s.target).attr("name");return q.stack[r].active()});if(this.footerMenuItem){d("a[name="+this.footerMenuItem.name+"]",this.footerMenu).addClass("active")}return this.footerMenuLoaded=true};k.prototype.appendQuickBar=function(m){return this.quickBar.append(d("#menuItemTmpl").tmpl(m))};k.prototype.clearQuickBar=function(){return this.quickBar.empty()};k.prototype.appendHeaderMenu=function(m){return this.headerDropMenu.append(d("#menuItemTmpl").tmpl(m))};k.prototype.clearHeaderMenu=function(){return this.headerDropMenu.empty()};k.prototype.addPanel=function(m){var n=this;this.manager.add(m);this.content.append(m.el);if(m.headerMenuItem){this.appendHeaderMenu(m.headerMenuItem);d("a[name="+m.headerMenuItem.name+"]",this.headerDropMenu).click(function(){return n[m.headerMenuItem.name].active()})}return this.el};k.prototype.slientActive=function(r){var m,q,o,p,n;p=this.manager.controllers;n=[];for(q=0,o=p.length;q<o;q++){m=p[q];if(m===r){n.push(m.el.addClass("active"))}else{n.push(m.el.removeClass("active"))}}return n};k.prototype.getActive=function(){var m,n,p,o;o=this.controllers;for(n in o){p=o[n];if(this[n].isActive()){m=this[n]}}return m||(m=this[this["default"]])};k.prototype.activate=function(){var m,n;m=1<=arguments.length?e.call(arguments,0):[];k.__super__.activate.apply(this,arguments);this.loadFooterMenu();return(n=this.getActive())!=null?n.active.apply(n,m):void 0};k.prototype.refresh=function(){var m;return(m=this.getActive())!=null?m.refresh():void 0};k.prototype.registerPageEvent=function(m,n){return this.stack.registerPageEvent(m,this,n)};k.prototype.triggerPageEvent=function(){var m,n;m=1<=arguments.length?e.call(arguments,0):[];return(n=this.stack).trigger.apply(n,m)};return k})(Spine.Controller);f=(function(k){c(l,k);function l(m){l.__super__.constructor.apply(this,arguments);Spine.Route.setup()}l.prototype.getActive=function(){var m,n,p,o;o=this.controllers;for(n in o){p=o[n];if(this[n].isActive()){m=this[n]}}return m||(m=this[this["default"]])};l.prototype.getFooterMenu=function(){var n,p,o,m;o=this.controllers;m=[];for(n in o){p=o[n];if(this[n].footerMenuItem){m.push(this[n].footerMenuItem)}}return m};l.prototype.registerPageEvent=function(m,n,p){var o=this;return this.bind(m,function(){var q;q=1<=arguments.length?e.call(arguments,0):[];if(p.apply(null,q)){return n.active.apply(n,q)}})};return l})(Spine.Stack);h=(function(k){c(l,k);l.prototype.tmplId=null;function l(){l.__super__.constructor.apply(this,arguments);this.el.attr("data-role","panel")}l.prototype.refresh=function(m){if(typeof m==="function"){return this.bind("refresh",m)}else{return this.trigger("refresh",m)}};l.prototype.activate=function(){l.__super__.activate.apply(this,arguments);return this.refresh(arguments)};l.prototype.isActive=function(){if(this.page.isActive()===false){return false}return l.__super__.isActive.apply(this,arguments)};return l})(Spine.Controller);b=(function(l){c(k,l);function k(){k.__super__.constructor.apply(this,arguments);this.bind("dataReady",this.render);this.bind("refresh",this.fetchData)}k.prototype.render=function(m){this.el.html(d("#"+this.tmplId).tmpl(m));return this.refreshElements()};return k})(h);a=(function(l){c(k,l);function k(){k.__super__.constructor.apply(this,arguments);this.el.html(d("#"+this.tmplId).html());this.refreshElements();this.refresh(this.render)}return k})(h);i=(function(k){c(l,k);function l(){l.__super__.constructor.apply(this,arguments);this.bind("dataReady",this.render);this.bind("refresh",this.fetchData);this.el.html(d("#"+this.tmplId).html());this.refreshElements()}return l})(h);window.Stock.Panel=h;window.Stock.DynamicPanel=b;window.Stock.StaticPanel=a;window.Stock.MixedPanel=i;window.Stock.Page=j;window.Stock.PageStack=f}).call(this);